{% extends "layouts/base.html" %}
{% load static %}
{% load crispy_forms_tags %}
{% load widget_tweaks %}
{% load jalali_tags %}

{% block title %}تیکت های پشتیبانی 
{{ request.user.get_full_name|default:"حساب من" }}
{% endblock %}


{% block css %}
        
{% endblock css %}


{% block breadcrumb %}

{% endblock breadcrumb %}


{% block content %}

<div class="container mt-4 mb-4">
    <a href="{% url 'profiles:tickets' %}" class="btn btn-success">
        لیست تیکت ها
    </a>
    <br>
    <hr>
	<div class="">
        <div class="container" style="display: flex; flex-direction: column; align-items: flex-start; width: 100%;">
            <div class="card card-body" style="width: 80%; margin-bottom: 20px;">
                <div class="ticket-info" style="display: flex; justify-content: space-between; align-items: center;">
                    <div class="user-name" style="font-weight: bold;">
                        {{ ticket.title }}
                    </div>
                    <div class="ticket-title">
                        {{ ticket.user.get_full_name }}
                    </div>
                </div>
                <hr>
                <p style="font-size:14px">
                    {{ ticket.description|safe }}
                </p>
                <hr>
                <p style="font-size:14px">
                    ایجاد شده در : {{ ticket.get_date_created }}- وضعیت : {{ ticket.get_status }}
                </p>
            </div>
            {% if default_message and not admin_message %}
                <div class="card card-body" style="width: 80%; margin-bottom: 20px; align-self: flex-end;background-color:#f1f2f2">
                    <div class="ticket-info" style="display: flex; justify-content: space-between; align-items: center;">
                        <div class="user-name" style="font-weight: bold;">
                            پاسخ به تیکت شما
                        </div>
                        <div class="ticket-title">ادمین</div>
                    </div>
                    <hr>
                    <p style="font-size:14px">
                        {{ default_message.body|safe }}
                    </p>
                    <hr>
                    <p style="font-size:14px">
                        ارسال شده در :‌ {{ ticket.get_date_created }}
                    </p>
                </div>
            {% endif %}
           
            {% for message in ticket.messages.all %}
                {% if message.admin_reply %}
                    <div class="card card-body" style="width: 80%; margin-bottom: 20px; align-self: flex-end;background-color:#f1f2f2">
                        <div class="ticket-info" style="display: flex; justify-content: space-between; align-items: center;">
                            <div class="user-name" style="font-weight: bold;">
                                پاسخ به تیکت شما
                            </div>
                            <div class="ticket-title">ادمین</div>
                        </div>
                        <hr>
                        <p style="font-size:14px">
                            {{ message.body }}
                        </p>
                        <hr>
                        <p style="font-size:14px">
                            ارسال شده در :‌ {{ message.get_date_sent }}
                        </p>
                    </div>

                {% else %}  
                    
                    <div class="card card-body" style="width: 80%; margin-bottom: 20px; ">
                        <div class="ticket-info" style="display: flex; justify-content: space-between; align-items: center;">
                            <div class="user-name" style="font-weight: bold;">
                                 پیام شما
                            </div>
                            <div class="ticket-title">{{ ticket.user.get_full_name }}</div>
                        </div>
                        <hr>
                        <p style="font-size:14px">
                            {{ message.body }}
                        </p>
                        <hr>
                        <p style="font-size:14px">
                            ارسال شده در :‌ {{ message.get_date_sent }}
                        </p>
                    </div>
                    
                {% endif %}
            {% endfor %}


            <div class="card card-body" style="width: 100%; margin-bottom: 20px; align-self: flex-end;background-color:#fff">
                <div class="ticket-info" style="display: flex; justify-content: space-between; align-items: center;">
                    <div class="user-name" style="font-weight: bold;">
                        ارسال پیام
                    </div>
                    
                </div>
                <hr>
                <form method="post" enctype="multipart/form-data">
                    {% csrf_token %}
                    {% if form.errors %}
                        {% for field in form %}
                            {% for error in field.errors %}
                                <div class="alert alert-danger m-1">
                                    <strong>{{ field.label }}:&nbsp;</strong><span>{{ error|escape }}</strong>
                                </div>
                            {% endfor %}
                        {% endfor %}
                        {% for error in form.non_field_errors %}
                            <div class="alert alert-danger">
                                <strong>{{ error|escape }}</strong>
                            </div>
                        {% endfor %}
                    {% endif %}

                    <div class="form-group">
                        <div class="col-md-12">
                            <div class="row">
                                <div class="col-lg-12 col-md-12 col-12 form-group mb-4">
                                    {{ form.body|as_crispy_field }}
                                </div>
                            </div>
                        </div>
                        <input type="submit" value="ارسال" class="btn btn-success btn-xs" style="width:150px">
                    </div>
                    
                </form>
            </div>
        </div>
	</div>
</div>
<br><br><br>
{% endblock content %}